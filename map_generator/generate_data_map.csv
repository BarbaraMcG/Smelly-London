#!/usr/bin/env python3

import smell_hits
import pprint
import csv
import sys
import os

def latitude_longitude_from_location_name(location_name):
    """ From the file borough_feature_data assumes that the third column is the location name
        and returns the (latitude, longitude) from the columns (first, second).
    """

    cwd = os.path.dirname(__file__)
    borough_data_path = os.path.join(cwd, "..", "generate_boroughs", "all_borough_data.csv")
    locationsfile = open(borough_data_path, "r", newline="")

    locationsreader = csv.reader(locationsfile)

    for line in locationsreader:
        if location_name == line[3]:
            return(line[0], line[1])

    raise LookupError(location_name + " not found")

def create_carto_file():
    """ Creates a .csv file to be uploaded into http://carto.com with the smells. """
    csvfile=open("carto.csv", "w", newline="")

    mapwriter = csv.writer(csvfile, delimiter=",", quoting=csv.QUOTE_ALL)

    mapwriter.writerow(["longitude", "latitude", "year", "location_name", "number_of_smells"])

    for borough_name, borough_information in smell_hits.res.items():
        for year, number_of_smells in borough_information.items():
            (latitude, longitude) = latitude_longitude_from_location_name(borough_name)
            mapwriter.writerow([latitude, longitude, year, borough_name, number_of_smells])

if __name__ == "__main__":
    create_carto_file()
